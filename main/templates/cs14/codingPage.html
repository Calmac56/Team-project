{% extends 'cs14/base.html' %}
{% load static %}


{% block head_block %}
<link rel="stylesheet" href="{% static 'css/codingPage.css'%}" type="text/css">

<script>
    var Code = `{{ code }}`;
    var Language = '{{ language }}';
    var taskID = '{{ taskID }}';
    var CustomInput = `{{ input }}`;




    function doPost(Submission){
        var CustomInputCB = document.getElementById("customInputCB").checked;
        var CSRFtoken = '{{ csrf_token }}';
        var data = 'csrfmiddlewaretoken=' + CSRFtoken + "&language=" + Language + "&codeArea=" + encodeURIComponent(Code) + "&inputArea=" + encodeURIComponent(CustomInput) + "&customInputCB=" + CustomInputCB + "&submission=" + Submission + "&taskID=" + taskID;
        if (CustomInputCB && Submission == 'true'){
            alert("Cannot submit with custom input.");
        }
        else{
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "{% url 'cs14:sendCode' %}", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhr.send(data);
            xhr.onreadystatechange = function() {
                if (Submission == 'true'){
                window.location.replace("{% url 'cs14:cresults' %}");
            }
                if (xhr.readyState === 4) {
                    document.getElementById('output').value = xhr.responseText;
                }
                
            }
        }
       
    };

    function updateCookies(){
        var CSRFtoken = '{{ csrf_token }}';
        var data = 'csrfmiddlewaretoken=' + CSRFtoken + "&language=" + Language + "&code=" + encodeURIComponent(Code) + "&input=" + encodeURIComponent(CustomInput);

        var xhr = new XMLHttpRequest();
        xhr.open("POST", "{% url 'cs14:codingPageCookie' %}", true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.send(data);
    };
</script>

{% endblock %}


{% block title_block %}
CODEEEEE
{% endblock %}

{% block body_block %}
<div class="description">
    <h2>Task Description</h2>
    <p>{{taskDec}}
        <br>
        Expected Out: {{taskout}}
    </p>
    </br>
</div>
<div class="timerContainer">
    <div class="timeTop">
        <div class="timeL">
            <p id="time"></p>
        </div>
        <div class="timeR">
            <p id="timeFull"></p>
        </div>
    </div>
    <div class="timeBottom">
        <div class="timer">
        </div>
    </div>
</div>
<div class="codeContainer">
    <div class="codeEditor">
        <div class="editorTopBar">
            <div class="editorTitle">CODE</div>
            <select id='languageSelector' class="editorTopBarForm">
                <option value="java">JAVA</option>
                <option value="python">PYTHON</option>
                <option value="c">C</option>
                <option value="c#">C#</option>
            </select>
            <button id='runButton' type="button" onclick="doPost('false')" class="editorTopBarForm">RUN</button>
            <button id='submitButton' type="button" onclick="doPost('true')" class="editorTopBarForm">SUBMIT</button>
        </div>
        <div class="typerContainer">
            <div class="codeTyper" id="codeArea" name="codeArea"></div>
        </div>
    </div>
    <div class="codeIo">
        <div class="codeInput">
            <div class="editorTopBar">
                <div class="editorTitle">CUSTOM INPUT<input type="checkbox" id="customInputCB" value="USE CUSTOM INPUT"></div>
            </div>
            <textarea class="inputArea" id="inputArea" name="inputArea" rows="20" cols="140"></textarea>
        </div>
        <div class="codeOutput">
            <div class="editorTopBar">
                <div class="editorTitle">OUTPUT</div>
            </div>
            <textarea readonly class="outputArea" name="outputArea" id="output" rows="20" cols="140"></textarea>
        </div>
    </div>
</div>

<script src="https://pagecdn.io/lib/ace/1.4.12/ace.js"></script>
<script src="https://pagecdn.io/lib/ace/1.4.12/theme-tomorrow_night.js"></script>
<script src="{% static 'js/editorSettings.js'%}"></script>

<script src="{% static 'js/timer.js'%}"></script>
<script src="{% static 'js/codeLanguageUpdate.js'%}"></script>


<script>
    editor.getSession().setValue(Code);
    editor.getSession().setMode("ace/mode/" + Language.toLowerCase());
    document.getElementById('inputArea').value = CustomInput;

    window.onload = function () {
        var tasktime = {{ time }};
        var tasktimefull = {{ time_total }};
        var time_submit = '{{ submit }}';
        
        if (time_submit == "true") 
        {
            doPost('true');
        }

        display = document.querySelector('#time');
        displayFull = document.querySelector('#timeFull');
        startTimer(tasktime, tasktimefull, display, displayFull);
    };
</script>
{% endblock %}