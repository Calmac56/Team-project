{% extends 'cs14/base.html' %}
{% load static %}

{% block head_block %}
<link rel="stylesheet" href="{% static "css/results.css"%}" type="text/css">


{% endblock %}


{% block title_block %}
Candidate results
{% endblock %}

{% block body_block %}
<script>
  $.get('/cs14/getresultsession', function(data) {
    var options = document.getElementById('selectbox')
    if (data != ""){
    options.remove(0);
    for(var i =0; i<options.length; i++){
      if (options[i].value===data) {
        options[i].selected= true;
        break;
    }
  }
}
  else{

    options[0].selected = true;
    
  }

    
    

    
    
    
});
</script>

<script>
  $(document).ready(function() {
    $('.js-example-basic-single').select2();
});

</script>

<form class="form-inline my-2 my-lg-0" id="searchform">
  <select class="js-example-basic-single" name="state" id='selectbox' onchange="this.form.submit()" >
  <option value="defaultop" id="default" selected="selected">Select a candidate </option>
  {% for candidate in candidates %}
  <option value="{{candidate.user.username}}">{{candidate.user.username}}</option>
  {% endfor %}
</select>
</form>


<br>
{% if results != None %}
{% for result in results %}
<p>Test {{result.taskID.taskID}} - {{result.taskID.name}} </p>
<script>


    function viewMore(id) {


 
  var btnText = document.getElementById(id);
  var text = id.toString();
  
  const slug = text.substring(text.indexOf('n') + 1);
  var moreText = document.getElementById("more" + slug);


  if (moreText.style.display === "none") {
    btnText.innerHTML = "Hide results";
    moreText.style.display = "inline";
  } else {

    btnText.innerHTML = "View results";
    moreText.style.display = "none";
  }
}

</script>
<button  class="btn btn-outline-success my-2 my-sm-0" onclick="viewMore(this.id)" style="width: 40%; margin-left: 30%;" id="myBtn{{result.taskID.taskID}}">View results</button> 
<span id="more{{result.taskID.taskID}}" style="display: None;"> 

    <table class="tg">
    <thead>
      <tr>
        <th class="tg-0lax">Task ID</th>
        <th class="tg-0lax"> Tests Passed</th>
        <th class="tg-0lax">Tests Failed</th>
        <th class="tg-0lax">Pass Percentage</th>
        <th class="tg-0lax">Time taken</th>
        <th class="tg-0lax"> Complexity </th>
      
        <th class="tg-0lax">Description</th>
        <th class="tg-0lax">Code</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="tg-0lax">{{result.taskID.taskID}}</td>
        <td class="tg-0lax">{{result.tests_passed}}</td>
        <td class="tg-0lax">{{result.tests_failed}}</td>
        <td class="tg-0lax">{{result.passpercentage}}</td>
        <td class="tg-0lax">{{result.timetaken}}</td>
        <td class="tg-0lax">{{result.complexity}}</td>
        <td class="tg-0lax">{{result.taskID.description}}</td>
        <td class="tg-0lax"> <a href="{% url 'cs14:creview'  result.taskID.taskID %}">View code</a></td>
      </tr>
    </tbody>
    </table>
    </span>
<br>
{% endfor %}
{% else %}
<p> This candidate has not completed any coding tests</p>
{% endif %}

{% endblock %}



